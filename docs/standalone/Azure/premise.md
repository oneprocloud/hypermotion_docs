# 迁移环境部署前提准备


---
## 1. 安装包下载

1.	请点击获取以下镜像文件并上传至源端平台

- [HM_IMG-191227-2020-09-02.qcow2](https://oneprocloud.oss-cn-beijing.aliyuncs.com/download/HM_IMG-191227-2020-09-02.qcow2)


?> **「HyperMotion主控平台」**建议使用此镜像进行安装部署，具体安装部署操作参照[迁移安装部署](https://docs.oneprocloud.com/#/standalone/aws/vmdeploy)部分的操作说明。

---

## 2.环境及资源准备

?> 请在目标端Azure平台上确认以下信息：



### 2.1 访问端口开通

!> 安装或迁移操作前，请务必完成此步骤，否则安装和迁移步骤无法进行！


1.（源平台）预定实例「HyperMotion主控平台」安装所在地域下已开放**访问端口：22、18088、18766、10080**

2. 预定实例「HyperGate云端数据代理」安装所在地域下已创建安全组，并已放行以下**入口端口号：18090、3260、1222、22**


?> 此处开放了必须的迁移所必须的访问端口权限，开通后所有人都可以通过以以上端口对预定安装实例进行访问；如需限制可访问对象，请参考以2.2 网络访问策略开通的说明。

---

### 2.2 网络访问策略


!> 安装或迁移操作前，根据实际需求（对可访问对象有限制）情况选择性开通此步骤。


?> 迁移所需开放的所有**网络访问策略**，请按照以下条目进行端口开放



|   | 访问端         | 被访问端       | 通信方向/开放端口（被访问端）                    | 备注                                                         |
| - | -------------- | --------------- | ----------------------------------------------------------- | -------------------------------------------------------------- |
| 1 | HyperMotion主机    | HyperGate主机       | 单向：18090、3260、12222、22                               | 迁移组件程序                                             |
| 2 | HyperMotion主机                | (源)VCenter平台        | 单向：443 (VMware场景)                | 作为迁移源端：认证端口                              |
| 3 |HyperMotion主机                | (源)ESXI主机    | 单向：902 (VMware场景)                                               | 作为迁移源端：数据传输端口                        |
| 4 |  HyperMotion主机               | 源端待迁移主机 | 单向：19981       | 源端为Agent方式                                           |
| 5 | HyperGate主机      | 目标云台API网络 | 单向：5000、35357、9696、8773、8774、8775、8776、9191、9292 | **场景：迁移目标端为私有云** 例如：OpenStack，其他私有云视情况而定 |
| 6 | 源端待迁移主机 | HyperGate主机       | 单向：3260                                               | 源端待迁移主机为Agent方式（物理机、KVM/Xen虚拟机等） |
| 7 |  源端待迁移主机              | HyperMotion主机     | 单向：18766，10080                                      |                                                                |
| 8 | 操作迁移终端主机   | HyperMotion 主机    | 单向：18088、22  | 迁移软件web浏览器访问以及后台管理远程SSH端口
| 9 | 操作迁移终端主机   | yperMotion 主机    | 单向：22  | 迁移软件web浏览器访问以及后台管理远程SSH端口


?> **以下代名词说明：** </br>
**1.HyperMotion主机:** 「HyperMotion主控平台」所安装实例</br>
**2.HyperGate主机:** 「HyperGate云端数据代理」所安装实例</br>
**3.VCenter/ESXI主机:** 源端VMware环境作为源端进行迁移</br>
**4.源端待迁移主机:** 安装Agent进行迁移的虚拟机或物理机</br>
**5.操作迁移终端主机:** 通过web浏览器访问迁移软件的终端主机</br>

---

### 2.3 账户权限开通

**1. 源平台账户**

!> 如源端环境为VMware平台请提前开通，其他请忽略。

提供以下具有管理员权限的VCenter账号密码，以供迁移时创建VC连接：</br>
需要的具体角色权限包含：</br>

?>①任务-创建任务 &ensp; &ensp; &ensp;&ensp; &ensp; &ensp; &ensp;&ensp; &ensp;&ensp;&ensp; &ensp;&ensp; &ensp;②数据存储-浏览数据存储</br>
③数据存储集群-配置数据存储集群&ensp;&ensp; ④虚拟机-快照管理（创建快照）</br>
⑤虚拟机-配置（磁盘更改跟踪） &ensp; &ensp;&ensp;  ⑥虚拟机-置备（允许对磁盘进行只读访问） </br>
⑦虚拟机-置备（允许访问磁盘）


**2. Azure账户**

 
?>  按照条目对迁移账户进行所需权限开放

 |   | 目标云端 | 权限          | 权限条目        | 备注          |
 | - | -------- | --------------- | ------------------- | --------------- |
 | 1 | Azure| API权限 | Azure Active Directory | 以编程方式访问目录数据和对象 |
 | 2 |          | API权限 |Azure Service Management| 以编程方式访问Azure门户提供的大部分功能 |
  | 3 |          | 访问控制（IAM） |添加HyperMotion应用程序的订阅服务访问控制权限| 开通订阅服务并添加访问控制权限 |
  | 3 |          | 访问控制（IAM） |添加用户的订阅服务访问控制权限| 开通订阅服务并添加访问控制权限 |
  
  
!> 1.**API权限的添加方式**请参照附录 Azure平台权限管理中的[API权限添加](Appendix?id=51-api%e6%9d%83%e9%99%90%e6%b7%bb%e5%8a%a0)进行添加；</br>
   2.**订阅服务访问控制（IAM）权限的添加方式**请参照附录 Azure平台权限管理中的[订阅服务访问控制权限（IAM）](Appendix?id=52-%e8%ae%a2%e9%98%85%e6%9c%8d%e5%8a%a1%e8%ae%bf%e9%97%ae%e6%8e%a7%e5%88%b6%e6%9d%83%e9%99%90%ef%bc%88iam%ef%bc%89)进行添加；</br>

---

### 2.4 创建资源组

?>  请在预定实例「HyperGate云端数据代理」安装所在地域下创建资源组

!> 1.**资源组的创建方式**请参照请参照参照Azure文档中[创建资源组](https://docs.microsoft.com/zh-cn/azure/azure-resource-manager/management/manage-resource-groups-portal)的说明。</br>
