# 迁移环境部署前提准备


---

## 1. 安装包下载

请点击获取以下两个镜像文件并上传至**金山云平台**：



- 镜像1：[HM_IMG-191227-2020-09-02.qcow2](http://office.oneprocloud.com:18888/iso/hypermotion/%e6%9d%ad%e5%b7%9e%e6%94%bf%e5%8a%a1%e4%ba%91/HM_IMG-191227-2020-03-19.raw)

- 镜像2：[Livecd-HyperDoor-202006170931.qcow2](http://office.oneprocloud.com:18888/iso/hypermotion/%e6%9d%ad%e5%b7%9e%e6%94%bf%e5%8a%a1%e4%ba%91/HM_IMG-191227-2020-03-19.raw)



?>1. **「HyperMotion主控平台」**与 **「HyperGate云端数据代理」**均使用**镜像1**进行安装部署，具体安装部署操作参照<a href="http://office.oneprocloud.com:18888/iso/hypermotion/%e6%9d%ad%e5%b7%9e%e6%94%bf%e5%8a%a1%e4%ba%91/HM_IMG-191227-2020-03-19.raw" download="HyperMotion-V3-full.raw">迁移安装部署</a>部分的操作说明；</br>
2.  &ensp; **镜像2**为迁移主机迁移至金山云后的驱动自适配镜像。


!> 上传方式请参考金山云文档中的导入自定义镜像[导入镜像](https://docs.ksyun.com/documents/5335)
，或联络我们的实施工程师获取共享镜像。</br>




---

## 2.环境及资源准备

?> 请在目标端金山云平台上确认以下信息：


### 2.1 访问端口开通

!> 安装或迁移操作前，请务必完成此步骤，否则安装和迁移步骤无法进行！


1. 预定实例「HyperMotion主控平台」安装所在地域下已创建安全组，</br>并确保安全组已放行以下**入口端口号：22、18088、18766、10080**

2. 预定实例「HyperGate云端数据代理」安装所在地域下已创建安全组，</br>并确保安全组已放行以下**入口端口号：18090、3260、1222、22**


?> 此处开放了必须的迁移所必须的访问端口权限，开通后所有人都可以通过以以上端口对预定安装实例进行访问；如需限制可访问对象，请参考2.2 网络访问策略开通的说明。

---

### 2.2 网络访问策略


!> 安装或迁移操作前，根据实际需求（对可访问对象有限制）情况选择性开通此步骤。


?> 迁移所需开放的所有**网络访问策略**，请按照以下条目进行端口开放


|   | 访问端         | 被访问端       | 通信方向/开放端口（被访问端）                    | 备注                                                         |
| - | -------------- | --------------- | ----------------------------------------------------------- | -------------------------------------------------------------- |
| 1 | HyperMotion主机    | HyperGate主机       | 单向：18090、3260、12222、22                               | 迁移组件程序                                             |
| 2 | HyperMotion主机                | (源)VCenter平台        | 单向：443 (VMware场景)                | 作为迁移源端：认证端口                              |
| 3 |HyperMotion主机                | (源)ESXI主机    | 单向：902 (VMware场景)                                               | 作为迁移源端：数据传输端口                        |
| 4 |  HyperMotion主机               | 源端待迁移主机 | 单向：19981       | 源端为Agent方式                                           |
| 5 | HyperGate主机      | 目标云台API网络 | 单向：5000、35357、9696、8773、8774、8775、8776、9191、9292 | **场景：迁移目标端为私有云** 例如：OpenStack，其他私有云视情况而定 |
| 6 | 源端待迁移主机 | HyperGate主机       | 单向：3260                                               | 源端待迁移主机为Agent方式（物理机、KVM/Xen虚拟机等） |
| 7 |  源端待迁移主机              | HyperMotion主机     | 单向：18766，10080                                      |                                                                |
| 8 | 操作迁移终端主机   | HyperMotion 主机    | 单向：18088、22  | 迁移软件web浏览器访问以及后台管理远程SSH端口
| 9 | 操作迁移终端主机   | yperMotion 主机    | 单向：22  | 迁移软件web浏览器访问以及后台管理远程SSH端口


?> **以下代名词说明：** </br>
**1.HyperMotion主机:** 「HyperMotion主控平台」所安装实例</br>
**2.HyperGate主机:** 「HyperGate云端数据代理」所安装实例</br>
**3.VCenter/ESXI主机:** 源端VMware环境作为源端进行迁移</br>
**4.源端待迁移主机:** 安装Agent进行迁移的虚拟机或物理机</br>
**5.操作迁移终端主机:** 通过web浏览器访问迁移软件的终端主机</br>
---

### 2.3 账户权限开通

**1. 源平台账户**

!> 如源端环境为VMware平台请提前开通，其他请忽略。

提供以下具有管理员权限的VCenter账号密码，以供迁移时创建VC连接：</br>
需要的具体角色权限包含：</br>

?>①任务-创建任务 &ensp; &ensp; &ensp;&ensp; &ensp; &ensp; &ensp;&ensp; &ensp;&ensp;&ensp; &ensp;&ensp; &ensp;②数据存储-浏览数据存储</br>
③数据存储集群-配置数据存储集群&ensp;&ensp; ④虚拟机-快照管理（创建快照）</br>
⑤虚拟机-配置（磁盘更改跟踪） &ensp; &ensp;&ensp;  ⑥虚拟机-置备（允许对磁盘进行只读访问） </br>
⑦虚拟机-置备（允许访问磁盘）




