---


### 1.1	网络带宽建议
迁移过程中主要通过网络进行数据拷贝，所以推荐的网络速度如下：
1) **全量数据同步**，建议最小带宽10Mbps
2) **增量数据同步**，建议最小带宽1Mbps


### 1.2	源平台限制信息

**1.	Linux物理机**</br>
- 文件系统仅支持ext2, ext3，ext4，xfs，ntfs，目前暂时不支持btrfs(SUSE 12默认的安装系统)；</br>
- 挂载文件系统的分区的需要预留10%的空间，例如：root分区的大小为100G，则剩余空间需要在10G以上；</br>
- 不支持没有挂载文件系统的分区同步；</br>
- 不支持没有划分分区的磁盘同步；</br>
- 不支持多路径磁盘同步（受不同厂商多路径软件的局限）；</br>
- 不支持复杂的LVM结构（仅支持单个VG的情况）；</br>
- 不支持裸设备同步；</br>
- 安装Linux Agent时需要yum clean all，旧的yum源信息可能会造成HyperGate无法安装。</br>

**2.    VMware版本约束条件**</br>

虚拟化 | 版本   |   环境
------------- | ----------------------| ----------------------
VMware  |ESXi/vCenter/VMFS≥5.0 |虚拟机磁盘格式不可为RDM（RawDiskMapping）格式
  |   | 仅支持VMFS磁盘，虚拟机磁盘； </br>支持格式：FlatVer1, FlatVer2, SparseVer1, SparseVer2；</br>虚拟机版本: ≥7；</br> VMFS<5.5时：单磁盘容量必须<2032GB。
 |  |虚拟机支持Change Block Tracking
 |   |虚拟机磁盘模式必须为persistent
 |EXSi6.0|必须安装VMware ESXi 6.0 Build 2715440，
 
**3.    热迁移约束条件**</br>

- 虚拟机磁盘格式不可为RDM（RawDiskMapping）格式；</br>
- 仅支持VMFS磁盘，虚拟机磁盘支持格式：FlatVer1, FlatVer2, SparseVer1, SparseVer2；</br>
- 虚拟机版本: ≥7；</br>
- VMFS<5.5时：单磁盘容量必须<2032GB；</br>
- 不支持虚拟机中含有通过iSCSI方式共享磁盘的虚拟机。</br>

**4.    其他限制条件**</br>

- 在使用该工具前，为避免产生影响，建议停用一切VMware备份软件。例：Veeam、爱数等。</br>
- HyperMotion理论上不会对业务造成影响，但实际操作中，以下情况可能会出现快照过程中业务短时中断：</br>
(1). 虚拟机正在使用的磁盘有损坏；</br>
(2). 迁移中，用户手动对快照进行操作--【建议：不要手动对快照进行操作】；</br>
(3). 业务系统I/O过大，导致磁盘长时间处于100%利用率--【建议：在非
忙时执行数据拷贝】；</br>
(4). 用户待迁移的主机长时间没有重启或者有非常旧的快照（半年以上）--【建议：用户对系统进行关机，并手动触发一次快照后再执行迁移】。</br>

---
### 1.3. 目标平台限制信息


#### 1.3.1 阿里云（公）

- 首次迁移上云后，默认将该实例镜像用按量付费的形式创建，验证后可删除该实例，手动将该镜像创建实例，改为包月形式;</br>
- 阿里云目前最小支持20G的盘，如果源端有小于20G的盘，上云后默认扩大为20G的盘;</br>
- 迁移时，源主机磁盘个数不能大于18个盘;</br>
- 阿里云平台的目标云平台服务只能挂载16个盘，需要手动调整 (将目前20个卷设定改为16个卷受设定)；源主机磁盘个数不能大于16个盘;</br>
- 由于目前阿里云系统盘最大为500 GB，所以待迁移的主机的系统盘不能大于500 GB，根据阿里云官方提供的方法，在大于500G的情况下，需手动的对源系统进行缩容。

---
#### 1.3.2 AWS


- 目前只支持CentOS6/Centos7版本的迁移；</br>
- 支持RHEL/CentOS 6.x & 7.x版本迁移；</br>
- 迁移RHEL/CentOS 6.x & 7.x前需要将源系统内部防火墙关闭或开放22端口，否则迁移后无法远程连接；</br>
- 迁移Windows版本前需要将源系统内部防火墙关闭或开放远程桌面3389端口，否则迁移后无法远程连接；</br>
- 迁移到AWS时支持创建卷格式为gp2；</br>
- 在AWS创建HyperGate时建议使用 "社区AMI CentOS" 以下版本镜像；</br>
- Linux HyperDoor创建流程：HyperGate安装完成后 --> 关机，使用HyperGate实例生成Linux HyperDoor镜像；</br>
- 建议使用以下版本镜像为基础制作Windows HyperDoor镜像；</br>
- 不支持源端 "OpenStack+Ceph (Agentless)" 迁移至AWS；</br>
- 迁移后主机所在的 "域、可用区、VPC、子网、安全组" 皆需与HyperGate一致；</br>
- 仅支持T3系列的实例类型，T3限制挂盘最多28个、网口至少占用1个、实例根卷用1个；极限条件下，T3系的实例最多能附加3个网口，HyperGate最多仅能同时挂载20个卷 (迁移用)；</br>
- 目标云平台服务最大同时挂载卷 (磁盘) 个数为：20个。</br>

---

#### 1.3.3 Azure

- 实例磁盘限制最大容量为: 32TB；
- 由于Azure临时存储盘的关系，HyperGate数据盘会由第三块盘开始挂载 (第一块盘: 系统盘，第二块盘: 临时存储盘)；</br>
- 由于Azure临时存储盘的关系，Windows主机迁移后需登入系统将数据盘手动启动 (Activate)，并指定盘符 (若Windows系统没有自动给予盘符)；</br>
- Azure目前仅支持Windows 2008 SP2及以上版本的实例类型；HyperMotion迁移支持Windows 2008 R2及以上版本和RHEL/CentOS 6 & 7版本操作系统，包含驱动修复功能 (磁盘及网络自动获取修复) (Windows 2008 SP2不支持手动或自动驱动修复)；</br>
- HyperGate最大同时挂载卷 (磁盘) 个数为：16个 (HyperGate实例类型: F4)。</br>

---
#### 1.3.4 腾讯云（公）

- 迁移上云后，默认使用按量付费形式创建实例，验证后可手动改为包月或其他形式；</br>
- 迁移使用的HyperDoor为内存OS系统，启动实例时内存最小需求为2GB；</br>
- 驱动修复时需要进行系统盘全量数据拷贝，启动实例耗费时间较长；</br>
- HyperDoor方式实例启动时会较长时间占用HyperGate Worker数，建议HyperGate使用CPU个数较高的配置 (目前worker数等于CPU个数)，建议8-Core或以上；</br>
- 目前不支持在启动实例时选择Region和Zone，即所有迁移上云的实例都需和HyperGate处于相同区域；</br>
- 启动实例不支持安全组选择，默认需和HyperGate相同；</br>
- 腾讯云系统盘最小支持50GB最大支持1TB (SSD类型最大支持500GB)；</br>
- 腾讯云数据盘根据类型不同支持最小容量10GB和最大容量16000GB，且磁盘容量为10GB的整数倍；</br>
- 迁移时，源主机磁盘个数最多支持20个盘；</br>
- Windows 2016主机在迁移后配置DHCP方式获取不到IP地址，需要人为介入；</br>
- Windows 2003主机在迁移后驱动修复有无法成功的几率发生 (会进入HyperDoor画面而不是正常操作系统画面)，解决方式可尝试重新启动实例；</br>
- Linux主机在迁移后会使用DHCP服务分配动态主机名，导致原静态主机名失效；</br>
- HyperGate最大同时挂载卷 (磁盘) 个数为：20个。</br>

---

#### 1.3.5 华为云（公）

- 此版本针对Windows 2003操作系统迁移不支持网卡驱动修复；</br>
- Windows 2012 / R2、Windows 2016操作系统迁移网卡驱动需要待实例启动成功后手动安装；</br>
- 迁移后主机所在的 "域、可用区、VPC、子网、安全组" 皆需与目标云平台服务一致；</br>
- 华为公有云实例支持：系统盘最小容量40GB、最大1TB， 数据盘最小容量10GB、最大32TB；如果源主机系统和数据磁盘不足40GB或10GB，默认会以支持最小值创建；</br>
- 目标云平台服务最大同时挂载卷 (磁盘) 个数为：23个。</br>

---

#### 1.3.6 金山云

- 迁移到金山公有云的系统如果启动失败那么需要重新同步数据；</br>
- 迁移系统的系统盘大小只能小于等于20GB。</br>

---
#### 1.3.7 OpenStack


- 迁移使用的HyperDoor为内存OS系统，启动实例时内存最小需求为2GB；</br>
- 驱动修复时需要进行系统盘全量数据拷贝，启动实例耗费时间较长；</br>
- 如驱动修复程序于HyperDoor进行，不会占用同步时HyperGate可用同时挂载卷数量；</br>
- 启动实例不支持安全组选择，默认需和HyperGate相同；</br>
- HyperGate最大同时挂载卷 (磁盘) 个数为：20个。</br>

---

#### 1.3.8 青云



- 迁移使用的HyperDoor为内存OS系统，启动实例时内存最小需求为2GB。</br>
- 驱动修复时需要进行系统盘全量数据拷贝，启动实例耗费时间较长；</br>
- 由于驱动修复程序于HyperDoor进行，并不会占用同步时HyperGate可用同时挂载卷数量；</br>
- 启动实例不支持安全组选择，默认需和HyperGate相同；</br>
- HyperGate最大同时挂载卷 (磁盘) 个数为：20个。</br>

---

#### 1.3.9 UCloud


- 安装建议选择通用型N主机；</br>
- 最大挂载volume数目：建议不超过5个。</br>
---

#### 1.3.10 ZStack


- 在迁移过程中，由于ZStack平台暂无法获取虚拟机内部磁盘信息，因此不能重启HyperGate，否则将导致迁移失败；
- 目前只支持管理员账户进行鉴权，不支持其他方式，例：LDAP、项目登陆等；
- 仅支持使用管理员权限的用户操作HyperMotion：在创建卷的过程中，需要创建卷规格，该操作权限目前只能支持管理员用户 (ZStack限制)；
- 若迁移主机包含多块磁盘，迁移后所有磁盘必须存在同一个存储资源池内；
- ZStack暂无提供根据卷ID对应盘符的方法 (virtio驱动)，通过对比磁盘差异的方式适配；所以磁盘挂载后不支持手动卸载，必须由前端触发清理资源 (如果手动卸载后，会导致HyperGate无法启动主机)；
- ZStack镜像为独立副本，迁移后启动主机需要较长时间；
- 在ZStack上不支持将HyperGate布署于Centos 7.1 & 7.2上，会出现找不到磁盘路径的问题； 
- ZStack不支持Boot from Volume方式启动虚拟机，需将卷转为镜像后通过指定镜像服务器UUID实现启动主机流程；
- 如果镜像服务器UUID填写错误并不会阻碍流程，但是会影响主机启动，需要修改HyperGate Cloud Info文件；
- 迁移过程中，HyperGate不能进行重启；由于目前无法从虚拟机内部获取磁盘信息和云平台块设备进行关系对应，重启会导致磁盘顺序乱序；
- 由于ZStack平台对每台虚拟机挂载的盘最大不允许超过24个，所以在迁移至ZStack平台时，HyperGate最大挂载盘限制在15个 (剩馀可挂磁盘数保留给HyperGate系统盘及驱动修复用)。

---
#### 1.3.11 Ceph存储需求

如果使用的后端存储为Ceph，建议使用链式快照作为默认方式，这样在验
证过程时会加快启动速度，在迁移完成后可以将该种方式修改回非链式。</br>（使
用链式快照在资源清理时会遇到快照依赖关系的问题，需要使用flattern命
令进行断链操作。）

```
/etc/cinder/cinder.conf
[ceph]   rbd_flatten_volume_from_snapshot = False
```

---

#### 1.3.12 网络需求

- HyperMotion与HyperGate之间能通过IP地址互相访问；
- HyperGate可以访问云平台 API网络，并且能够正常调用云平台 API接口。





