## 1 概述

### 1.1	迁移概念
将应用系统在不改变原有架构基础上进行系统、应用及数据进行搬迁至私有云或公有云目标平台，并能持续正常运行。</br>
迁移的本质是系统和数据完整复制在目标平台完整恢复。</br>

### 1.2	迁移场景
云计算时代的迁移大致分为3个场景：上云、回迁及转迁</br>
①	上云：从原有的物理机 / 虚拟机迁移至云平台 (私有云或公有云)。</br>
②	回迁：应用主机从云平台 (私有云或公有云) 迁移至本地虚拟化平台或私有云平台。</br>
③	转迁：将应用主机从一个云平台迁移至另一个云平台。</br>
随着云计算的迅速普及，以上场景顺序发生，并愈发频繁，迁移成为资产自由流转的必要工具。</br>

### 1.3	迁移实现原理

#### 1.3.1	云主机创建原理
云计算实现的基础是虚拟化，虚拟化即使用软件模拟硬件。在物理世界里，一台服务器至少包含：CPU、内存、硬盘和网卡。云平台创建虚拟机的过程就是通过计算虚拟化、存储虚拟化和网络虚拟化模拟出上述设备，之后的引导方式与启动过程，都与物理环境相当。</br>
在几乎所有云平台中 (包含公有云和私有云) 都支持两种方式创建云主机：</br>
①	从云硬盘卷启动创建</br>
②	从镜像创建</br>
**主用 - 从云硬盘卷启动创建：** 直接将卷作为虚拟机的引导磁盘，快速启动虚拟机。该种方式就如同在物理环境下，两台硬件配置完全相同的服务器，把第一台主机的硬盘安装在第二台主机后，系统仍然可以正常启动。该种方式非常适合于迁移场景的需求使用。</br>
**次用 – 从镜像创建：**以满足不支持卷启动的平台。</br>

#### 1.3.2	停机 & 业务连续性要求
云计算普及，企业上云迫切，但对于业务系统停机的时间窗要求是尽量趋于0，这对传统迁移 (冷迁移 & 半自动迁移) 方法来说无法实现，严重影响企业上云决策。</br>
传统方法迁移是原有业务系统关机后，将数据保存为云平台可以使用的镜像文件，上传至云平台进行使用的方式。该种方式最大的缺陷就是人为参与多、迁移时间长、业务中断时间非常长，不适用于平台化操作。</br>
**万博智云采用：**连续保护的方式将数据直接保存至云平台块存储后在云平台进行卷挂载后直接启动实例的方法，在保护和挂载启动过程中无需中断生产业务，对于有业务连续性要求，运行在主流操作系统上的业务系统都能采用该种方法进行迁移，在最短时间内，将业务系统迁移至云平台上运作。</br>

## 2 HyperMotion万博智云迁移方案

### 2.1	方案概述
保证业务系统数据一致性的基础上完成跨任意平台迁移。</br>
万博智云迁移基于同一原理针对不同场景，有2个方案可搭配采用：</br>
**方案一：网络传输** – 网络条件良好推荐使用此方案</br>
源应用系统数据直接通过网络传输到云平台进行保存，然后触发卷启动虚机，完成迁移。</br>
![wp_intersync.png](https://oneprocloud.oss-cn-beijing.aliyuncs.com/_images/whitepage/wp_intersync.png ':size=80%')

**方案二：移动式存储设备** – 针对数据量巨大，网络条件不佳推荐使用此方案</br>
将源应用系统数据拷贝到自研物理存储设备 – **MotionGear**，再将设备运输至目标云平台，将数据切换到云平台存储中，然后触发卷启动虚机，完成迁移。</br>
![wp_mgsync.png](https://oneprocloud.oss-cn-beijing.aliyuncs.com/_images/whitepage/wp_mgsync.png ':size=80%')

### 2.2	方案优势
万博智云旨在让迁移成为云时代企业资产流转的利器，助力企业安全、高效上云，自由任意选择云资源，畅享云计算。</br>
实现流程原理：</br>
![impleprinc.png](https://oneprocloud.oss-cn-beijing.aliyuncs.com/_images/whitepage/impleprinc.png ':size=80%')

在进行系统设计和方案建设中主要遵循以下原则，打造优势特性：</br>
- **源端0干扰：无代理设计，针对源系统无需做任何操作，不用安装Agent。**</br>
<注1：VMware及OpenStack + Ceph环境虚机无需安装代理 ></br>
<注2：物理机和其他平台虚机通过安装Agent代理方式完成迁移></br>
- **系统不停机、业务不中断**</br>
采用块级保护方式为基础，在保证业务系统连续性的基础上完成迁移。</br>
- **目标端无预操作**</br>
在目标云平台无需提前预启动虚机，无需安装配置系统；启动过程中会由HyperMotion工具自动调度云平台API接口挂载并启动实例。</br>
- **任意跨平台，多平台交互X2X迁移**</br>
从物理机、从虚拟平台迁移至云平台，以及云平台之间交互迁移。</br>
采用标准化设计和开放的接口协议，对接各类云平台，实现系统资产自由流转。</br>
- **服务产品化、工具自动化、减少人为干预**</br>
打破传统迁移重人力项目化的实施方式，将服务产品化，标准化；通过软件安装，UI交互界面操作轻松实现云迁移。</br>
- **摆脱繁琐技术配置**</br>
“系统 + 应用 + 数据”全对象整体备份，无需重装操作系统、重构数据，无需担心架构兼容问题。</br>
- **随时验证，安全保障**</br>
挂载至云平台启动运行，验证无误后再进行切换，完成迁移。</br>
![advscheme.png](https://oneprocloud.oss-cn-beijing.aliyuncs.com/_images/whitepage/advscheme.png ':size=80%')

### 2.3	迁移环境部署
迁移软件提供3种形态：</br>
①单机版： 占用独立资源（虚机*2）进行部署</br>
②SaaS版：万博智云运营并以SaaS形式提供使用</br>
③集成：   迁移产品被集成到云平台或云管平台以功能模块提供自服务</br>
迁移工具由2部分组成：<HyperMotion主控平台> + <HyperGate云端代理组件></br>
![deparch.png](https://oneprocloud.oss-cn-beijing.aliyuncs.com/_images/whitepage/deparch.png ':size=80%')

### 2.4	迁移流程说明
①	源端拷贝：</br>
对源业务系统进行首次全量拷贝 (快照)</br>
②	数据传输：</br>
将数据传输到目标云平台存储保存 (通过网络或MotionGear)，用户可以根据实际业务系统的使用情况对网络传输流量进行合理限速。</br>
③	目标端启动：</br>
将备份卷在云平台挂载启动业务系统，登录进入验证系统状态。</br>
④	迁移切换：</br>
当用户决策确认要切换平台时，将源业务系统暂停、创建一个最终增量拷贝 (快照)，使用该业务系统快照在目标云平台完成最新挂载，实现业务系统的最终迁移切换。</br>
<注：使用快照恢复的目的是当发生迁移失败后，原盘数据仍然可以作为备份盘使用></br>

### 2.5	对系统影响

#### 2.5.1	CPU和内存
VMware与OpenStack + Ceph源端环境无需安装代理，对虚机系统无任何影响。</br>
物理机与其他平台虚机，代理运作时对CPU的平均负载消耗仅在1%-5%之内。</br>

#### 2.5.2	磁盘读写和网络传输
在数据拷贝时通过对系统存储的限速，严格控制传输速率和网络接口限速，保证业务系统的运行。限速需要根据用户实际的业务系统平均负载以及网络带宽决定。</br>
<例如：需要保护的物理机与云平台之间的连接为40Mbps，系统在忙时对带宽的利用率为80%，磁盘负载平均在50%以下，综合以上两个条件，建议用户设定的限速值为10Mbps (1.2MB/s)></br>

#### 2.5.3	源端系统重启与备份
如果用户对于数据安全性管理方面有特殊要求以及用户对于业务系统长时间运作后的改变 (代理安装) 有所疑虑，建议在进行代理安装或迁移前将源业务系统排定重启并进行备份，将可能发生问题的机会降低；具体的重启、备份动作和时程安排由业务系统负责人完成。</br>
在实践中，代理的安装并不会对原有业务系统运行环境造成任何破坏。</br>

#### 2.5.4	系统回退
源业务系统始终仍在正常运行，并未受到影响，无需进行回退或其他操作。</br>
该迁移方案中整个迁移过程是对源业务系统的系统、应用、和数据进行拷贝并传输至目标云平台存储，基于相同数据在云平台上运行业务系统 (迁移切换)，此种方式迁移前、后的源数据皆保持一致。</br>

## 3 HyperMotion迁移关键技术

### 3.1	块 (Block） 级别复制
万博智云采用块级数据复制，复制的对象是操作系统 + 应用 + 应用配置 + 数据，迁移时不受文件系统类型约束，是实现整体 (业务级) 挂载恢复的基础。</br>

### 3.2	HyperGate – 目标存储管理与智能驱动适配
![hg_pic.png](https://oneprocloud.oss-cn-beijing.aliyuncs.com/_images/whitepage/hg_pic.png ':size=10%')

万博智云自主开发的云平台适配模块，通过该模块可以：</br>
①	存储解耦：解除源系统和对应存储的绑定关系，将任意云平台存储作为迁移存储提供给应用主机使用。</br>
②	智能驱动适配：解决跨平台场景中普遍存在的驱动转换等问题，提供驱动自动适配、注入功能无需人为介入。</br>
③	云平台调度处理：用户不再受存储绑定，不受异构平台驱动转换限制，实现任意选择云平台、资产自由流转。</br>

### 3.3	MotionGear – 移动式存储设备，数据传输辅助使用
![mg_pic.png](https://oneprocloud.oss-cn-beijing.aliyuncs.com/_images/whitepage/mg_pic.png ':size=10%')

适用于源系统首次全量拷贝数据量巨大，异地传输超过网络传输条件承载力时。</br>
将源端业务系统数据全量拷贝至MotionGear，通过物理运输至目标云平台处，对接HyperGate后自动将拷贝数据导入目标存储、完成存储切换，提高首次全量数据拷贝效率；后续通过网络持续进行增量数据拷贝传输。</br>

## 4 HyperMotion软件规格

### 4.1	极致产品化设计
![hm_overview_desc.png](https://oneprocloud.oss-cn-beijing.aliyuncs.com/_images/whitepage/hm_overview_desc.png ':size=30%')

![hm_overview_pic.png](https://oneprocloud.oss-cn-beijing.aliyuncs.com/_images/whitepage/hm_overview_pic.png ':size=80%')

![hm_guide_desc.png](https://oneprocloud.oss-cn-beijing.aliyuncs.com/_images/whitepage/hm_guide_desc.png ':size=30%')

![hm_guide_pic.png](https://oneprocloud.oss-cn-beijing.aliyuncs.com/_images/whitepage/hm_guide_pic.png ':size=80%')

## 5 平台兼容列表
![hm_spot_list.png](https://oneprocloud.oss-cn-beijing.aliyuncs.com/_images/whitepage/hm_spot_list.png ':size=80%')

## 6 支持与服务

### 6.1	技术方案建议
![methodology.png](https://oneprocloud.oss-cn-beijing.aliyuncs.com/_images/whitepage/methodology.png ':size=30%')

### 6.2	故障响应支持
![fault_spt.png](https://oneprocloud.oss-cn-beijing.aliyuncs.com/_images/whitepage/fault_spt.png ':size=30%')